version: '3'

services:

  web:
    build:
      context: .
      dockerfile: Dockerfile
    env_file: .env # Set environment variables from an `.env` file, if needed
    command: mix phoenix.server # Start the server if no other command is specified
    tty: true
    environment:
      - MIX_ENV=dev # That's the environment mode, you know
      - PORT=4000
      - PG_HOST=postgres
      - PG_USERNAME=postgres
      - PG_DATABASE=elixir_elm_bootstrap
      - PG_PASSWORD=postgres
    volumes:
      - elixir:/app
    ports:
      - "4000:4000"
      #- "4001:4001"
    links:
      - postgres

  #test:
  #  image: elixirelmbootstrap_web # We're just using the already built `web` image here
  #  env_file: .env
  #  command: mix test # Run the entire test suite if no other command is specified
  #  environment:
  #    - MIX_ENV=test # That's key
  #    - PORT=4002
  #    - PG_HOST=postgres
  #    - PG_USERNAME=postgres
  #    - PG_DATABASE=elixir_elm_bootstrap_test
  #    - PG_PASSWORD=postgres
  #  volumes_from:
  #    - web
  #  links:
  #    - postgres

  webpack:
    image: playlist-pal/web
    command: ./node_modules/.bin/webpack-dev-server --host 0.0.0.0 --port 4001 --colors
    tty: true
    volumes:
      - elixir:/app
    ports:
     - 4001:4001

  postgres:
    image: postgres:9.5 # https://hub.docker.com/_/postgres/
    ports:
      - "5432"

volumes:
  elixir: ~